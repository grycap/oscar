
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../usage/">
      
      
        <link rel="next" href="../fdl/">
      
      
      <link rel="icon" href="../images/logo.png">
      <meta name="generator" content="mkdocs-1.6.0, mkdocs-material-9.5.24">
    
    
      
        <title>Invoking services - OSCAR Documentation</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.6543a935.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#invoking-services" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="OSCAR Documentation" class="md-header__button md-logo" aria-label="OSCAR Documentation" data-md-component="logo">
      
  <img src="../images/logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            OSCAR Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Invoking services
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/grycap/oscar" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="OSCAR Documentation" class="md-nav__button md-logo" aria-label="OSCAR Documentation" data-md-component="logo">
      
  <img src="../images/logo.png" alt="logo">

    </a>
    OSCAR Documentation
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/grycap/oscar" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Introduction
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Getting started
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Getting started
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../local-testing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Local testing
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../deploy-im-dashboard/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Deployment with IM Dashboard
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../deploy-ec3/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Deployment with EC3
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../deploy-helm/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Deployment with Helm
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../deploy-ansible/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Deployment on K3s with Ansible
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Third party integrations
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Third party integrations
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../egi-integration/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Integration with EGI
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../oidc-auth/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    OIDC Authorization
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../sgx-integration/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Integration with SCONE
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../usage/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Using OSCAR through the web-based UI
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Invoking services
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Invoking services
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#service-access-tokens" class="md-nav__link">
    <span class="md-ellipsis">
      Service access tokens
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#synchronous-invocations" class="md-nav__link">
    <span class="md-ellipsis">
      Synchronous invocations
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Synchronous invocations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#inputoutput" class="md-nav__link">
    <span class="md-ellipsis">
      Input/Output
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#oscar-cli" class="md-nav__link">
    <span class="md-ellipsis">
      OSCAR-CLI
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#curl" class="md-nav__link">
    <span class="md-ellipsis">
      cURL
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#limitations" class="md-nav__link">
    <span class="md-ellipsis">
      Limitations
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#exposed-services" class="md-nav__link">
    <span class="md-ellipsis">
      Exposed services
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Exposed services">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#prerequisites-in-the-container-image" class="md-nav__link">
    <span class="md-ellipsis">
      Prerequisites in the container image
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#how-to-define-an-exposed-oscar-service" class="md-nav__link">
    <span class="md-ellipsis">
      How to define an exposed OSCAR service
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../fdl/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Functions Definition Language (FDL)
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../fdl-composer/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    FDL Composer
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../oscar-cli/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    OSCAR-CLI
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../api/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    OpenAPI Specification
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../multitenancy/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Multitenancy
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../minio-bucket-replication/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    MinIO bucket replication
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../faq/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Frequently Asked Questions (FAQ)
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../license/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    License
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../about/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    About
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#service-access-tokens" class="md-nav__link">
    <span class="md-ellipsis">
      Service access tokens
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#synchronous-invocations" class="md-nav__link">
    <span class="md-ellipsis">
      Synchronous invocations
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Synchronous invocations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#inputoutput" class="md-nav__link">
    <span class="md-ellipsis">
      Input/Output
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#oscar-cli" class="md-nav__link">
    <span class="md-ellipsis">
      OSCAR-CLI
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#curl" class="md-nav__link">
    <span class="md-ellipsis">
      cURL
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#limitations" class="md-nav__link">
    <span class="md-ellipsis">
      Limitations
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#exposed-services" class="md-nav__link">
    <span class="md-ellipsis">
      Exposed services
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Exposed services">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#prerequisites-in-the-container-image" class="md-nav__link">
    <span class="md-ellipsis">
      Prerequisites in the container image
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#how-to-define-an-exposed-oscar-service" class="md-nav__link">
    <span class="md-ellipsis">
      How to define an exposed OSCAR service
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="invoking-services">Invoking services</h1>
<p>OSCAR services can be invoked synchronously and asynchronously sending an
HTTP POST request to paths <code>/run/&lt;SERVICE_NAME&gt;</code> and <code>/job/&lt;SERVICE_NAME&gt;</code>
respectively. For file processing, OSCAR automatically manages the creation
and <a href="https://docs.min.io/minio/baremetal/monitoring/bucket-notifications/bucket-notifications.html#minio-bucket-notifications">notification system</a>
of MinIO buckets in order to allow the event-driven invocation of services
using asynchronous requests, generating a Kubernetes job for every file to be
processed.</p>
<h2 id="service-access-tokens">Service access tokens</h2>
<p>As detailed in the <a href="../api/">API specification</a>, invocation paths require the
service access token in the request header for authentication. Service access
tokens are auto-generated in service creation and update, and MinIO eventing
system is automatically configured to use them for event-driven file
processing. Tokens can be obtained through the API, using the
<a href="../oscar-cli/#get"><code>oscar-cli service get</code></a> command or directly from the web
interface.</p>
<p><img alt="oscar-ui-service-token.png" src="../images/usage/oscar-ui-service-token.png" /></p>
<h2 id="synchronous-invocations">Synchronous invocations</h2>
<p>Synchronous invocations allow obtaining the execution output as the response
to the HTTP call to the <code>/run/&lt;SERVICE_NAME&gt;</code> path. For this, OSCAR delegates
the execution to a Serverless Backend (<a href="https://knative.dev">Knative</a> or
<a href="https://www.openfaas.com/">OpenFaaS</a>). Unlike asynchronous invocations, that
are translated into Kubernetes jobs, synchronous invocations use a "function"
pod to handle requests. This is possible thanks to the
<a href="https://github.com/openfaas/classic-watchdog">OpenFaaS Watchdog</a>, which is
injected into each service and is in charge of forking the process to be
executed for each request received.</p>
<p><img alt="oscar-sync.png" src="../images/oscar-sync.png" /></p>
<p>Synchronous invocations can be made through OSCAR-CLI, using the comand
<code>oscar-cli service run</code>:</p>
<pre><code class="language-sh">oscar-cli service run [SERVICE_NAME] {--input | --text-input} {-o | -output }
</code></pre>
<p>You can check these use-cases:</p>
<ul>
<li><a href="https://oscar.grycap.net/blog/post-oscar-faas-sync-ml-inference/">plant-classification-sync</a></li>
<li><a href="https://oscar.grycap.net/blog/post-oscar-text-to-speech/">text-to-speech</a>.</li>
</ul>
<p>The input can be sent as a file via the <code>--input</code> flag, and the result of the
execution will be displayed directly in the terminal:</p>
<pre><code class="language-sh">oscar-cli service run plant-classification-sync --input images/image3.jpg
</code></pre>
<p>Alternatively, it can be sent as plain text using the <code>--text-input</code> flag and
the result stored in a file using the <code>--output</code> flag:</p>
<pre><code class="language-sh">oscar-cli service run text-to-speech --text-input &quot;Hello everyone&quot;  --output output.mp3
</code></pre>
<h3 id="inputoutput">Input/Output</h3>
<p><a href="https://github.com/grycap/faas-supervisor">FaaS Supervisor</a>, the component in
charge of managing the input and output of services, allows JSON or base64
encoded body in service requests. The body of these requests will be
automatically decoded into the invocation's input file available from the
script through the <code>$INPUT_FILE_PATH</code> environment variable.</p>
<p>The output of synchronous invocations will depend on the application itself:</p>
<ol>
<li>If the script generates a file inside the output dir available through the
    <code>$TMP_OUTPUT_DIR</code> environment variable, the result will be the file encoded in
    base64.</li>
<li>If the script generates more than one file inside <code>$TMP_OUTPUT_DIR</code>, the
    result will be a zip archive containing all files encoded in base64.</li>
<li>If there are no files in <code>$TMP_OUTPUT_DIR</code>, FaaS Supervisor will return its
    logs, including the stdout of the user script run.
    <strong>To avoid FaaS Supervisor's logs, you must set the service's <code>log_level</code>
    to <code>CRITICAL</code>.</strong></li>
</ol>
<p>This way users can adapt OSCAR's services to their own needs.</p>
<h3 id="oscar-cli">OSCAR-CLI</h3>
<p>OSCAR-CLI simplifies the execution of services synchronously via the
<a href="../oscar-cli/#run"><code>oscar-cli service run</code></a> command. This command requires the
input to be passed as text through the <code>--text-input</code> flag or directly a file
to be sent by passing its path through the <code>--input</code> flag. Both input types
are automatically encoded in base64.</p>
<p>It also allow setting the <code>--output</code> flag to indicate a path for storing
(and decoding if needed) the output body in a file, otherwise the output will
be shown in stdout.</p>
<p>An illustration of triggering a service synchronously through OSCAR-CLI can be
found in the <a href="https://github.com/grycap/oscar/tree/master/examples/cowsay#oscar-cli">cowsay example</a>.</p>
<pre><code class="language-sh">oscar-cli service run cowsay --text-input '{&quot;message&quot;:&quot;Hello World&quot;}'
</code></pre>
<h3 id="curl">cURL</h3>
<p>Naturally, OSCAR services can also be invoked via traditional HTTP clients
such as <a href="https://curl.se/">cURL</a> via the path <code>/run/&lt;SERVICE_NAME&gt;</code>. However,
you must take care to properly format the input to one of the two supported
formats (JSON or base64 encoded) and include the
<a href="#service-access-tokens">service access token</a> in the request.</p>
<p>An illustration of triggering a service synchronously through cURL can be
found in the
<a href="https://github.com/grycap/oscar/tree/master/examples/cowsay#curl">cowsay example</a>.</p>
<p>To send an input file through cURL, you must encode it in base64 or json. To avoid
issues with the output in synchronous invocations remember to put the
<code>log_level</code> as <code>CRITICAL</code>. Output, which is encoded in base64 or in json, should be
decoded as well. Save output in the expected format of the use-case.</p>
<pre><code class="language-sh">base64 input.png | curl -X POST -H &quot;Authorization: Bearer &lt;TOKEN&gt;&quot; \
 -d @- https://&lt;CLUSTER_ENDPOINT&gt;/run/&lt;OSCAR_SERVICE&gt; | base64 -d &gt; result.png
</code></pre>
<h3 id="limitations">Limitations</h3>
<p>Although the use of the Knative Serverless Backend for synchronous invocations provides elasticity similar to the one provided by their counterparts in public clouds, such as AWS Lambda, synchronous invocations are not still the best option to run long-running resource-demanding applications, like deep learning inference or video processing. </p>
<p>The synchronous invocation of long-running resource-demanding applications may lead to timeouts on Knative pods. Therefore, we consider Kubernetes job generation as the optimal approach to handle event-driven file processing through asynchronous invocations in OSCAR, being the execution of synchronous services a convenient way to support general lightweight container-based applications.</p>
<h2 id="exposed-services">Exposed services</h2>
<p>OSCAR also supports the deployment and elasticity management of long-running services that need to be directly reachable from outside the cluster (i.e. exposed services). This is useful when stateless services created out of large containers require too much time to be started to process a service invocation. This is the case when supporting the fast inference of pre-trained AI models that require close to real-time processing with high throughput. In a traditional serverless approach, the AI model weights would be loaded in memory for each service invocation (thus creating a new container). </p>
<p>Instead, by exposing an OSCAR service, the AI model weights could be loaded just once and the service would perform the AI model inference for each subsequent request. An auto-scaled load-balanced approach for these stateless services is supported. When the average CPU exceeds a certain user-defined threshold, additional service instances (i.e. pods) will be dynamically created (and removed when no longer necessary), within the user-defined boundaries (see the parameters <code>min_scale</code> and <code>max_scale</code> in <a href="https://docs.oscar.grycap.net/fdl/#exposesettings">ExposeSettings</a>).</p>
<h3 id="prerequisites-in-the-container-image">Prerequisites in the container image</h3>
<p>The container image needs to have an HTTP server that binds to a certain port (see the parameter <code>port</code> in <a href="https://docs.oscar.grycap.net/fdl/#exposesettings">ExposeSettings</a>`). If developing a service from scratch, in Python you can use <a href="https://fastapi.tiangolo.com/">FastAPI</a> or <a href="https://flask.palletsprojects.com/en/2.3.x/">Flask</a> to create an API. In Go you can use <a href="https://gin-gonic.com/">Gin</a> or <a href="https://sinatrarb.com/">Sinatra</a> in Ruby. </p>
<p>Notice that if the service exposes a web-based UI you must ensure that the content cannot only be served from the root document ('/'), since the service will be exposed in a certain subpath.</p>
<h3 id="how-to-define-an-exposed-oscar-service">How to define an exposed OSCAR service</h3>
<p>The minimum definition to expose an OSCAR service is to indicate in the corresponding <a href="https://docs.oscar.grycap.net/fdl/">FDL</a> file the port inside the container where the service will be listening.</p>
<pre><code class="language-yaml">expose:
  port: 5000
</code></pre>
<p>Once the service is deployed, if you invoke the service and it returns a <code>502 Bad Gateway</code> error, the port is wrong.</p>
<p>Additional options can be defined in the "expose" section, such as the minimum number of active pods (default: 1).
The maximum number of active pods (default: 10) or the CPU threshold which, once exceeded, will triger the creation of additional pods (default: 80%).</p>
<p>Below is a specification with more details where there will be between 5 to 15 active pods and the service exposes an API in port 4578. The number of active pods will grow when the use of CPU increases by more than 50%.
The active pods will decrease when the use of CPU decreases.</p>
<pre><code class="language-yaml">expose:
  min_scale: 5 
  max_scale: 15 
  port: 4578  
  cpu_threshold: 50
</code></pre>
<p>Below there is an example of a recipe to expose a service from the <a href="https://marketplace.deep-hybrid-datacloud.eu/">AI4EOSC/DEEP Open Catalog</a></p>
<pre><code class="language-yaml">functions:
  oscar:
  - oscar-cluster:
     name: body-pose-detection-async
     memory: 2Gi
     cpu: '1.0'
     image: deephdc/deep-oc-posenet-tf
     script: script.sh
     environment:
        Variables:
          INPUT_TYPE: json  
     expose:
      min_scale: 1 
      max_scale: 10 
      port: 5000  
      cpu_threshold: 20 
     input:
     - storage_provider: minio.default
       path: body-pose-detection-async/input
     output:
     - storage_provider: minio.default
       path: body-pose-detection-async/output
</code></pre>
<p>The service will be listening in a URL that follows the next pattern:</p>
<pre><code class="language-text">https://{oscar_endpoint}/system/services/{name of service}/exposed/
</code></pre>
<p>Now, let's show an example of executing the <a href="https://marketplace.deep-hybrid-datacloud.eu/modules/deep-oc-posenet-tf.html">Body pose detection</a> ML model of <a href="https://marketplace.deep-hybrid-datacloud.eu/">AI4EOSC/DEEP Open Catalog</a>. We need to have in mind several factors:</p>
<ol>
<li>OSCAR endpoint. <code>localhost</code> or <code>https://{OSCAR_endpoint}</code></li>
<li>Path resource. In this case, it is <code>v2/models/posenetclas/predict/</code>. Please do not forget the final <code>/</code></li>
<li>Use <code>-k</code> or <code>--insecure</code> if the SSL is false.</li>
<li>Input image with the name <code>people.jpeg</code></li>
<li>Output. It will create a <code>.zip</code> file that has the output</li>
</ol>
<p>The following code section represents a schema of the command:</p>
<pre><code class="language-bash">curl {-k} -X POST https://{oscar_endpoint}/system/services/body-pose-detection-async/exposed/{path resource} -H  &quot;accept: */*&quot; -H  &quot;Content-Type: multipart/form-data&quot; -F &quot;data=@{input image};type=image/png&quot; --output {output file}
</code></pre>
<p>Finally, the complete command that works in <a href="https://docs.oscar.grycap.net/local-testing/">Local Testing</a> with an image called <code>people.jpeg</code> as input and <code>output_posenet.zip</code> as output.</p>
<pre><code class="language-bash">curl -X POST https://localhost/system/services/body-pose-detection-async/exposed/v3/models/posenetclas/predict/ -H  &quot;accept: */*&quot; -H  &quot;Content-Type: multipart/form-data&quot; -F &quot;data=@people.jpeg;type=image/png&quot; --output output_posenet.zip
</code></pre>
<p>Another FDL example shows how to expose a simple NGINX server as an OSCAR service:</p>
<pre><code class="language-yaml">functions:
  oscar:
  - oscar-cluster:
     name: nginx
     memory: 2Gi
     cpu: '1.0'
     image: nginx
     script: script.sh
     expose:
      min_scale: 2 
      max_scale: 10 
      port: 80  
      cpu_threshold: 50 
</code></pre>
<p>In case you use the NGINX example above in your <a href="https://docs.oscar.grycap.net/local-testing/">local OSCAR cluster</a>, you will see the nginx welcome page in: <code>http://localhost/system/services/nginx/exposed/</code>.
Two active pods of the deployment will be shown with the command <code>kubectl get pods -n oscar-svc</code></p>
<pre><code class="language-text">oscar-svc            nginx-dlp-6b9ddddbd7-cm6c9                         1/1     Running     0             2m1s
oscar-svc            nginx-dlp-6b9ddddbd7-f4ml6                         1/1     Running     0             2m1s
</code></pre>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      &copy; 2022, GRyCAP - i3M - Universitat Politècnica de València, Spain.
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.081f42fc.min.js"></script>
      
    
  </body>
</html>